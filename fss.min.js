FSS={FRONT:0,BACK:1,DOUBLE:2,SVGNS:"http://www.w3.org/2000/svg"};FSS.Array=typeof Float32Array==="function"?Float32Array:Array;FSS.Utils={isNumber:function(a){return !isNaN(parseFloat(a))&&isFinite(a)}};(function(){var b=0;var d=["ms","moz","webkit","o"];for(var a=0;a<d.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[d[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[d[a]+"CancelAnimationFrame"]||window[d[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(i,e){var g=new Date().getTime();var f=Math.max(0,16-(g-b));var h=window.setTimeout(function(){i(g+f)},f);b=g+f;return h}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(e){clearTimeout(e)}}}());Math.PIM2=Math.PI*2;Math.PID2=Math.PI/2;Math.randomInRange=function(b,a){return b+(a-b)*Math.random()};Math.clamp=function(d,b,a){d=Math.max(d,b);d=Math.min(d,a);return d};FSS.Vector3={create:function(a,e,d){var b=new FSS.Array(3);this.set(b,a,e,d);return b},clone:function(d){var b=this.create();this.copy(b,d);return b},set:function(b,a,e,d){b[0]=a||0;b[1]=e||0;b[2]=d||0;return this},setX:function(b,a){b[0]=a||0;return this},setY:function(a,b){a[1]=b||0;return this},setZ:function(a,b){a[2]=b||0;return this},copy:function(d,b){d[0]=b[0];d[1]=b[1];d[2]=b[2];return this},add:function(d,b){d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];return this},addVectors:function(f,e,d){f[0]=e[0]+d[0];f[1]=e[1]+d[1];f[2]=e[2]+d[2];return this},addScalar:function(b,a){b[0]+=a;b[1]+=a;b[2]+=a;return this},subtract:function(d,b){d[0]-=b[0];d[1]-=b[1];d[2]-=b[2];return this},subtractVectors:function(f,e,d){f[0]=e[0]-d[0];f[1]=e[1]-d[1];f[2]=e[2]-d[2];return this},subtractScalar:function(b,a){b[0]-=a;b[1]-=a;b[2]-=a;return this},multiply:function(d,b){d[0]*=b[0];d[1]*=b[1];d[2]*=b[2];return this},multiplyVectors:function(f,e,d){f[0]=e[0]*d[0];f[1]=e[1]*d[1];f[2]=e[2]*d[2];return this},multiplyScalar:function(b,a){b[0]*=a;b[1]*=a;b[2]*=a;return this},divide:function(d,b){d[0]/=b[0];d[1]/=b[1];d[2]/=b[2];return this},divideVectors:function(f,e,d){f[0]=e[0]/d[0];f[1]=e[1]/d[1];f[2]=e[2]/d[2];return this},divideScalar:function(b,a){if(a!==0){b[0]/=a;b[1]/=a;b[2]/=a}else{b[0]=0;b[1]=0;b[2]=0}return this},cross:function(e,d){var b=e[0];var g=e[1];var f=e[2];e[0]=g*d[2]-f*d[1];e[1]=f*d[0]-b*d[2];e[2]=b*d[1]-g*d[0];return this},crossVectors:function(f,e,d){f[0]=e[1]*d[2]-e[2]*d[1];f[1]=e[2]*d[0]-e[0]*d[2];f[2]=e[0]*d[1]-e[1]*d[0];return this},min:function(b,a){if(b[0]<a){b[0]=a}if(b[1]<a){b[1]=a}if(b[2]<a){b[2]=a}return this},max:function(b,a){if(b[0]>a){b[0]=a}if(b[1]>a){b[1]=a}if(b[2]>a){b[2]=a}return this},clamp:function(d,b,a){this.min(d,b);this.max(d,a);return this},limit:function(e,b,a){var d=this.length(e);if(b!==null&&d<b){this.setLength(e,b)}else{if(a!==null&&d>a){this.setLength(e,a)}}return this},dot:function(e,d){return e[0]*d[0]+e[1]*d[1]+e[2]*d[2]},normalise:function(a){return this.divideScalar(a,this.length(a))},negate:function(a){return this.multiplyScalar(a,-1)},distanceSquared:function(g,e){var h=g[0]-e[0];var f=g[1]-e[1];var d=g[2]-e[2];return h*h+f*f+d*d},distance:function(e,d){return Math.sqrt(this.distanceSquared(e,d))},lengthSquared:function(b){return b[0]*b[0]+b[1]*b[1]+b[2]*b[2]},length:function(b){return Math.sqrt(this.lengthSquared(b))},setLength:function(d,a){var b=this.length(d);if(b!==0&&a!==b){this.multiplyScalar(d,a/b)}return this}};FSS.Vector4={create:function(a,f,e,d){var b=new FSS.Array(4);this.set(b,a,f,e);return b},set:function(d,a,f,e,b){d[0]=a||0;d[1]=f||0;d[2]=e||0;d[3]=b||0;return this},setX:function(b,a){b[0]=a||0;return this},setY:function(a,b){a[1]=b||0;return this},setZ:function(a,b){a[2]=b||0;return this},setW:function(b,a){b[3]=a||0;return this},add:function(d,b){d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];d[3]+=b[3];return this},multiplyVectors:function(f,e,d){f[0]=e[0]*d[0];f[1]=e[1]*d[1];f[2]=e[2]*d[2];f[3]=e[3]*d[3];return this},multiplyScalar:function(b,a){b[0]*=a;b[1]*=a;b[2]*=a;b[3]*=a;return this},min:function(b,a){if(b[0]<a){b[0]=a}if(b[1]<a){b[1]=a}if(b[2]<a){b[2]=a}if(b[3]<a){b[3]=a}return this},max:function(b,a){if(b[0]>a){b[0]=a}if(b[1]>a){b[1]=a}if(b[2]>a){b[2]=a}if(b[3]>a){b[3]=a}return this},clamp:function(d,b,a){this.min(d,b);this.max(d,a);return this}};FSS.Color=function(b,a){this.rgba=[];this.hex=b||"#000000";this.opacity=FSS.Utils.isNumber(a)?a:1;this.set(this.hex,this.opacity)};FSS.Color.prototype={set:function(f,b){if(f.indexOf("#")===-1){if(f.indexOf("rgb(")===0){var e=f.indexOf(",");this.rgba[0]=parseInt(f.substr(4,e));this.rgba[1]=parseInt(f.substr(e+1,f.indexOf(",",e)));this.rgba[2]=parseInt(f.substr(f.indexOf(",",e+1)+1,f.indexOf(")")));this.rgba[3]=1}else{if(f.indexOf("rgba(")===0){var e=f.indexOf(",");var a=f.indexOf(",",e+1);this.rgba[0]=parseInt(f.substr(5,e));this.rgba[1]=parseInt(f.substr(e+1,a));this.rgba[2]=parseInt(f.substr(f.indexOf(",",e+1)+1,f.indexOf(",",a)));this.rgba[3]=parseFloat(f.substr(f.indexOf(",",a+1)+1,f.indexOf(")")))}}}else{f=f.replace("#","");var d=f.length/3;this.rgba[0]=parseInt(f.substring(d*0,d*1),16)/255;this.rgba[1]=parseInt(f.substring(d*1,d*2),16)/255;this.rgba[2]=parseInt(f.substring(d*2,d*3),16)/255;this.rgba[3]=FSS.Utils.isNumber(b)?b:this.rgba[3]}return this},format:function(){return"rgba("+this.rgba[0]+","+this.rgba[1]+","+this.rgba[2]+","+this.rgba[3]+")"}};FSS.Object=function(){this.position=FSS.Vector3.create()};FSS.Object.prototype={setPosition:function(a,d,b){FSS.Vector3.set(this.position,a,d,b);return this}};FSS.Light=function(b,a){FSS.Object.call(this);this.ambient=new FSS.Color(b||"#FFFFFF");this.diffuse=new FSS.Color(a||"#FFFFFF");this.ray=FSS.Vector3.create()};FSS.Light.prototype=Object.create(FSS.Object.prototype);FSS.Vertex=function(a,d,b){this.position=FSS.Vector3.create(a,d,b)};FSS.Vertex.prototype={setPosition:function(a,d,b){FSS.Vector3.set(this.position,a,d,b);return this}};FSS.Triangle=function(e,d,f){this.a=e||new FSS.Vertex();this.b=d||new FSS.Vertex();this.c=f||new FSS.Vertex();this.vertices=[this.a,this.b,this.c];this.u=FSS.Vector3.create();this.v=FSS.Vector3.create();this.centroid=FSS.Vector3.create();this.normal=FSS.Vector3.create();this.color=new FSS.Color();this.polygon=document.createElementNS(FSS.SVGNS,"polygon");this.polygon.setAttributeNS(null,"stroke-linejoin","round");this.polygon.setAttributeNS(null,"stroke-miterlimit","1");this.polygon.setAttributeNS(null,"stroke-width","1");this.computeCentroid();this.computeNormal()};FSS.Triangle.prototype={computeCentroid:function(){this.centroid[0]=this.a.position[0]+this.b.position[0]+this.c.position[0];this.centroid[1]=this.a.position[1]+this.b.position[1]+this.c.position[1];this.centroid[2]=this.a.position[2]+this.b.position[2]+this.c.position[2];FSS.Vector3.divideScalar(this.centroid,3);return this},computeNormal:function(){FSS.Vector3.subtractVectors(this.u,this.b.position,this.a.position);FSS.Vector3.subtractVectors(this.v,this.c.position,this.a.position);FSS.Vector3.crossVectors(this.normal,this.u,this.v);FSS.Vector3.normalise(this.normal);return this}};FSS.Geometry=function(){this.vertices=[];this.triangles=[];this.dirty=false};FSS.Geometry.prototype={update:function(){if(this.dirty){var a,b;for(a=this.triangles.length-1;a>=0;a--){b=this.triangles[a];b.computeCentroid();b.computeNormal()}this.dirty=false}return this}};FSS.Plane=function(a,q,f,o){FSS.Geometry.call(this);this.width=a||100;this.height=q||100;this.segments=f||4;this.slices=o||4;this.segmentWidth=this.width/this.segments;this.sliceHeight=this.height/this.slices;var m,j,p,n,k,i,g,e,h=[],d=this.width*-0.5,b=this.height*0.5;for(m=0;m<=this.segments;m++){h.push([]);for(j=0;j<=this.slices;j++){g=new FSS.Vertex(d+m*this.segmentWidth,b-j*this.sliceHeight);h[m].push(g);this.vertices.push(g)}}for(m=0;m<this.segments;m++){for(j=0;j<this.slices;j++){p=h[m+0][j+0];n=h[m+0][j+1];k=h[m+1][j+0];i=h[m+1][j+1];t0=new FSS.Triangle(p,n,k);t1=new FSS.Triangle(k,n,i);this.triangles.push(t0,t1)}}};FSS.Plane.prototype=Object.create(FSS.Geometry.prototype);FSS.Material=function(b,a){this.ambient=new FSS.Color(b||"rgba(68,68,68, 1)");this.diffuse=new FSS.Color(a||"rgba(255,255,255, 1)");this.slave=new FSS.Color()};FSS.Mesh=function(b,a){FSS.Object.call(this);this.geometry=b||new FSS.Geometry();this.material=a||new FSS.Material();this.side=FSS.FRONT;this.visible=true};FSS.Mesh.prototype=Object.create(FSS.Object.prototype);FSS.Mesh.prototype.update=function(f,e){var k,j,d,g,a,b;b=f.length;this.geometry.update();if(e){for(k=this.geometry.triangles.length-1;k>=0;k--){j=this.geometry.triangles[k];FSS.Vector4.set(j.color.rgba);for(d=f.length-1;d>=0;d--){g=f[d];FSS.Vector3.subtractVectors(g.ray,g.position,j.centroid);FSS.Vector3.normalise(g.ray);a=FSS.Vector3.dot(j.normal,g.ray);if(this.side===FSS.FRONT){a=Math.max(a,0)}else{if(this.side===FSS.BACK){a=Math.abs(Math.min(a,0))}else{if(this.side===FSS.DOUBLE){a=Math.max(Math.abs(a),0)}}}for(var h=0;h<3;h++){this.material.slave.rgba[h]=(((1/b)*this.material.ambient.rgba[h])*((1/b)*g.ambient.rgba[h]))/128;if(h!==3){this.material.slave.rgba[h]=Math.round(this.material.slave.rgba[h])}}FSS.Vector4.add(j.color.rgba,this.material.slave.rgba);for(var h=0;h<3;h++){this.material.slave.rgba[h]=((1/b)*this.material.diffuse.rgba[h]*(1/b)*g.diffuse.rgba[h])/128;if(h!==3){this.material.slave.rgba[h]=Math.round(this.material.slave.rgba[h])}}for(var h=0;h<3;h++){this.material.slave.rgba[h]=Math.round(this.material.slave.rgba[h]*a)}FSS.Vector4.add(j.color.rgba,this.material.slave.rgba)}FSS.Vector4.clamp(j.color.rgba,0,255);j.color.rgba[3]=this.material.diffuse.rgba[3]}}return this};FSS.Scene=function(){this.meshes=[];this.lights=[]};FSS.Scene.prototype={add:function(a){if(a instanceof FSS.Mesh&&!~this.meshes.indexOf(a)){this.meshes.push(a)}else{if(a instanceof FSS.Light&&!~this.lights.indexOf(a)){this.lights.push(a)}}return this},remove:function(a){if(a instanceof FSS.Mesh&&~this.meshes.indexOf(a)){this.meshes.splice(this.meshes.indexOf(a),1)}else{if(a instanceof FSS.Light&&~this.lights.indexOf(a)){this.lights.splice(this.lights.indexOf(a),1)}}return this}};FSS.Renderer=function(){this.width=0;this.height=0;this.halfWidth=0;this.halfHeight=0};FSS.Renderer.prototype={setSize:function(b,a){if(this.width===b&&this.height===a){return}this.width=b;this.height=a;this.halfWidth=this.width*0.5;this.halfHeight=this.height*0.5;return this},clear:function(){return this},render:function(a){return this}};FSS.CanvasRenderer=function(){FSS.Renderer.call(this);this.element=document.createElement("canvas");this.element.style.display="block";this.context=this.element.getContext("2d");this.setSize(this.element.width,this.element.height)};FSS.CanvasRenderer.prototype=Object.create(FSS.Renderer.prototype);FSS.CanvasRenderer.prototype.setSize=function(b,a){FSS.Renderer.prototype.setSize.call(this,b,a);this.element.width=b;this.element.height=a;this.context.setTransform(1,0,0,-1,this.halfWidth,this.halfHeight);return this};FSS.CanvasRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);this.context.clearRect(-this.halfWidth,-this.halfHeight,this.width,this.height);return this};FSS.CanvasRenderer.prototype.render=function(h){FSS.Renderer.prototype.render.call(this,h);var a,i,e,g,d;var f=2*Math.PI;this.clear();this.context.lineJoin="round";this.context.lineWidth=1;for(a=h.meshes.length-1;a>=0;a--){i=h.meshes[a];if(i.visible){i.update(h.lights,true);for(e=i.geometry.triangles.length-1;e>=0;e--){g=i.geometry.triangles[e];c=g.color.rgba;d="rgba("+c[0]+","+c[1]+", "+c[2]+","+c[3]+")";this.context.beginPath();this.context.moveTo(g.a.position[0],g.a.position[1]);this.context.lineTo(g.b.position[0],g.b.position[1]);this.context.lineTo(g.c.position[0],g.c.position[1]);this.context.closePath();this.context.strokeStyle=d;this.context.stroke();this.context.fillStyle=d;this.context.fill();if(h.vertex.draw!==false){var b=this.context.createRadialGradient(g.a.position[0],g.a.position[1],h.vertex.radius+100,g.a.position[0],g.a.position[1],h.vertex.radius+105);b.addColorStop(0,"#8ED6FF");b.addColorStop(1,"#004CB3");this.context.beginPath();this.context.arc(g.a.position[0],g.a.position[1],h.vertex.radius,0,f,false);this.context.fillStyle=b;this.context.fill()}if(h.line.draw!==false){this.context.beginPath();this.context.moveTo(g.a.position[0],g.a.position[1]);this.context.lineTo(g.b.position[0],g.b.position[1]);this.context.strokeStyle=d;this.context.stroke();this.context.fillStyle=h.line.fill;this.context.fill();this.context.strokeStyle=h.line.fill;this.context.stroke()}}}}return this};FSS.WebGLRenderer=function(){FSS.Renderer.call(this);this.element=document.createElement("canvas");this.element.style.display="block";this.vertices=null;this.lights=null;var a={preserveDrawingBuffer:false,premultipliedAlpha:true,antialias:true,stencil:true,alpha:true};this.gl=this.getContext(this.element,a);this.unsupported=!this.gl;if(this.unsupported){return"WebGL is not supported by your browser."}else{this.gl.clearColor(0,0,0,0);this.gl.enable(this.gl.DEPTH_TEST);this.setSize(this.element.width,this.element.height)}};FSS.WebGLRenderer.prototype=Object.create(FSS.Renderer.prototype);FSS.WebGLRenderer.prototype.getContext=function(b,e){var d=false;try{if(!(d=b.getContext("experimental-webgl",e))){throw"Error creating WebGL context."}}catch(a){console.error(a)}return d};FSS.WebGLRenderer.prototype.setSize=function(b,a){FSS.Renderer.prototype.setSize.call(this,b,a);if(this.unsupported){return}this.element.width=b;this.element.height=a;this.gl.viewport(0,0,b,a);return this};FSS.WebGLRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);if(this.unsupported){return}this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);return this};FSS.WebGLRenderer.prototype.render=function(w){FSS.Renderer.prototype.render.call(this,w);if(this.unsupported){return}var n,a,k,d,q,o,e,j,r,p,y,b,h=false,x=w.lights.length,g,i,u,s,f=0;this.clear();if(this.lights!==x){this.lights=x;if(this.lights>0){this.buildProgram(x)}else{return}}if(!!this.program){for(n=w.meshes.length-1;n>=0;n--){a=w.meshes[n];if(a.geometry.dirty){h=true}a.update(w.lights,false);f+=a.geometry.triangles.length*3}if(h||this.vertices!==f){this.vertices=f;for(j in this.program.attributes){p=this.program.attributes[j];p.data=new FSS.Array(f*p.size);g=0;for(n=w.meshes.length-1;n>=0;n--){a=w.meshes[n];for(k=0,d=a.geometry.triangles.length;k<d;k++){q=a.geometry.triangles[k];for(i=0,u=q.vertices.length;i<u;i++){vertex=q.vertices[i];switch(j){case"side":this.setBufferData(g,p,a.side);break;case"position":this.setBufferData(g,p,vertex.position);break;case"centroid":this.setBufferData(g,p,q.centroid);break;case"normal":this.setBufferData(g,p,q.normal);break;case"ambient":this.setBufferData(g,p,a.material.ambient.rgba);break;case"diffuse":this.setBufferData(g,p,a.material.diffuse.rgba);break}g++}}}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,p.buffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,p.data,this.gl.DYNAMIC_DRAW);this.gl.enableVertexAttribArray(p.location);this.gl.vertexAttribPointer(p.location,p.size,this.gl.FLOAT,false,0,0)}}this.setBufferData(0,this.program.uniforms.resolution,[this.width,this.height,this.width]);for(o=x-1;o>=0;o--){e=w.lights[o];this.setBufferData(o,this.program.uniforms.lightPosition,e.position);this.setBufferData(o,this.program.uniforms.lightAmbient,e.ambient.rgba);this.setBufferData(o,this.program.uniforms.lightDiffuse,e.diffuse.rgba)}for(r in this.program.uniforms){p=this.program.uniforms[r];b=p.location;y=p.data;switch(p.structure){case"3f":this.gl.uniform3f(b,y[0],y[1],y[2]);break;case"3fv":this.gl.uniform3fv(b,y);break;case"4fv":this.gl.uniform4fv(b,y);break}}}this.gl.drawArrays(this.gl.TRIANGLES,0,this.vertices);return this};FSS.WebGLRenderer.prototype.setBufferData=function(b,a,e){if(FSS.Utils.isNumber(e)){a.data[b*a.size]=e}else{for(var d=e.length-1;d>=0;d--){a.data[b*a.size+d]=e[d]}}};FSS.WebGLRenderer.prototype.buildProgram=function(e){if(this.unsupported){return}var j=FSS.WebGLRenderer.VS(e);var g=FSS.WebGLRenderer.FS(e);var a=j+g;if(!!this.program&&this.program.code===a){return}var f=this.gl.createProgram();var i=this.buildShader(this.gl.VERTEX_SHADER,j);var b=this.buildShader(this.gl.FRAGMENT_SHADER,g);this.gl.attachShader(f,i);this.gl.attachShader(f,b);this.gl.linkProgram(f);if(!this.gl.getProgramParameter(f,this.gl.LINK_STATUS)){var h=this.gl.getError();var d=this.gl.getProgramParameter(f,this.gl.VALIDATE_STATUS);console.error("Could not initialise shader.\nVALIDATE_STATUS: "+d+"\nERROR: "+h);return null}this.gl.deleteShader(b);this.gl.deleteShader(i);f.code=a;f.attributes={side:this.buildBuffer(f,"attribute","aSide",1,"f"),position:this.buildBuffer(f,"attribute","aPosition",3,"v3"),centroid:this.buildBuffer(f,"attribute","aCentroid",3,"v3"),normal:this.buildBuffer(f,"attribute","aNormal",3,"v3"),ambient:this.buildBuffer(f,"attribute","aAmbient",4,"v4"),diffuse:this.buildBuffer(f,"attribute","aDiffuse",4,"v4")};f.uniforms={resolution:this.buildBuffer(f,"uniform","uResolution",3,"3f",1),lightPosition:this.buildBuffer(f,"uniform","uLightPosition",3,"3fv",e),lightAmbient:this.buildBuffer(f,"uniform","uLightAmbient",4,"4fv",e),lightDiffuse:this.buildBuffer(f,"uniform","uLightDiffuse",4,"4fv",e)};this.program=f;this.gl.useProgram(this.program);return f};FSS.WebGLRenderer.prototype.buildShader=function(a,d){if(this.unsupported){return}var b=this.gl.createShader(a);this.gl.shaderSource(b,d);this.gl.compileShader(b);if(!this.gl.getShaderParameter(b,this.gl.COMPILE_STATUS)){console.error(this.gl.getShaderInfoLog(b));return null}return b};FSS.WebGLRenderer.prototype.buildBuffer=function(d,g,e,f,b,h){var a={buffer:this.gl.createBuffer(),size:f,structure:b,data:null};switch(g){case"attribute":a.location=this.gl.getAttribLocation(d,e);break;case"uniform":a.location=this.gl.getUniformLocation(d,e);break}if(!!h){a.data=new FSS.Array(h*f)}return a};FSS.WebGLRenderer.VS=function(a){var b=["precision mediump float;","#define LIGHTS "+a,"attribute float aSide;","attribute vec3 aPosition;","attribute vec3 aCentroid;","attribute vec3 aNormal;","attribute vec4 aAmbient;","attribute vec4 aDiffuse;","uniform vec3 uResolution;","uniform vec3 uLightPosition[LIGHTS];","uniform vec4 uLightAmbient[LIGHTS];","uniform vec4 uLightDiffuse[LIGHTS];","varying vec4 vColor;","void main() {","vColor = vec4(0.0);","vec3 position = aPosition / uResolution * 2.0;","for (int i = 0; i < LIGHTS; i++) {","vec3 lightPosition = uLightPosition[i];","vec4 lightAmbient = uLightAmbient[i];","vec4 lightDiffuse = uLightDiffuse[i];","vec3 ray = normalize(lightPosition - aCentroid);","float illuminance = dot(aNormal, ray);","if (aSide == 0.0) {","illuminance = max(illuminance, 0.0);","} else if (aSide == 1.0) {","illuminance = abs(min(illuminance, 0.0));","} else if (aSide == 2.0) {","illuminance = max(abs(illuminance), 0.0);","}","vColor += aAmbient * lightAmbient;","vColor += aDiffuse * lightDiffuse * illuminance;","}","vColor = clamp(vColor, 0.0, 1.0);","gl_Position = vec4(position, 1.0);","}"].join("\n");return b};FSS.WebGLRenderer.FS=function(a){var b=["precision mediump float;","varying vec4 vColor;","void main() {","gl_FragColor = vColor;","}"].join("\n");return b};FSS.SVGRenderer=function(){FSS.Renderer.call(this);this.element=document.createElementNS(FSS.SVGNS,"svg");this.element.setAttribute("xmlns",FSS.SVGNS);this.element.setAttribute("version","1.1");this.element.style.display="block";this.setSize(300,150)};FSS.SVGRenderer.prototype=Object.create(FSS.Renderer.prototype);FSS.SVGRenderer.prototype.setSize=function(b,a){FSS.Renderer.prototype.setSize.call(this,b,a);this.element.setAttribute("width",b);this.element.setAttribute("height",a);return this};FSS.SVGRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);for(var a=this.element.childNodes.length-1;a>=0;a--){this.element.removeChild(this.element.childNodes[a])}return this};FSS.SVGRenderer.prototype.render=function(g){FSS.Renderer.prototype.render.call(this,g);var a,h,b,f,e,d;for(a=g.meshes.length-1;a>=0;a--){h=g.meshes[a];if(h.visible){h.update(g.lights,true);for(b=h.geometry.triangles.length-1;b>=0;b--){f=h.geometry.triangles[b];if(f.polygon.parentNode!==this.element){this.element.appendChild(f.polygon)}e=this.formatPoint(f.a)+" ";e+=this.formatPoint(f.b)+" ";e+=this.formatPoint(f.c);d=this.formatStyle(f.color.format());f.polygon.setAttributeNS(null,"points",e);f.polygon.setAttributeNS(null,"style",d)}}}return this};FSS.SVGRenderer.prototype.formatPoint=function(a){return(this.halfWidth+a.position[0])+","+(this.halfHeight-a.position[1])};FSS.SVGRenderer.prototype.formatStyle=function(a){var b="fill:"+a+";";b+="stroke:"+a+";";return b};(function(){$.fn.FSS=function(q){var M,B,aa,A;M=q.mesh||{};B=q.lights||[{}];aa=q.vertex||{};A=q.line||{};var v=function(i){var ac=[[],[]];var ab=[M,B];$.each(ab,function(ad){$.each(ab[ad],function(af,ah){if(typeof i.attr("data-fss-"+[af])!=="undefined"&&typeof i.attr("data-fss-"+[af])!==false){try{ac[ad][af]=$.parseJSON(i.attr("data-fss-"+[af]));return true}catch(ag){}if(typeof ac[ad][af]!=="object"){ac[ad][af]=i.attr("data-fss-"+[af])}}});var ae=(typeof i.attr("data-fss")!=="undefined"&&typeof i.attr("data-fss")!==false?$.parseJSON(i.attr("data-fss")):[]);$.extend(true,ac[ad],ae)});if(ie<9){$.each(ac,function(ad,ae){if(typeof p(ac[ad])!=="undefined"){ac[ad]=p(ac[ad])}if(typeof p(ac[ad])!=="undefined"){ac[ad]=p(ac[ad])}})}return ac};var p=function(i){try{var ab=i.split("(")}catch(ac){return}if(typeof ab[1]!=="undefined"){ab=ab[1].split(")")[0].split(",");return"rgb("+ab[0]+","+ab[1]+","+ab[2]+")"}return};var J={width:1.2,height:1.2,depth:10,segments:16,slices:8,xRange:0.8,yRange:0.1,zRange:1,ambient:"rgba(85, 85, 85, 1)",diffuse:"rgba(255, 255, 255, 1)",speed:0.002};var K={radius:0,fill:"rgba(0, 0, 0, 0)",strokeWidth:0,strokeColor:"rgba(0, 0, 0, 0)",draw:false};var E={fill:"rgba(0, 0, 0, 0)",draw:false};var Z={count:2,xyScalar:1,zOffset:100,ambient:"rgba(255,0,102, 1)",diffuse:"rgba(255,136,0, 1)",speed:0.01,gravity:1200,dampening:0.95,minLimit:10,maxLimit:null,minDistance:20,maxDistance:400,autopilot:false,draw:false,bounds:FSS.Vector3.create(),step:FSS.Vector3.create(Math.randomInRange(0.2,1),Math.randomInRange(0.2,1),Math.randomInRange(0.2,1))};M=$.extend(true,J,M);aa=$.extend(true,K,aa);A=$.extend(true,E,A);for(var W=0;W<B.length;W++){B[W]=$.extend(true,{},Z,B[W])}var h=$(this);var G=$("<div class='output' style='position:absolute; overflow:hidden; left:0px;right:0px; top:0; bottom:0;z-index:-1;'></div>");h.append(G);var Y=v(h);M=$.extend(true,M,Y[0]);var X="webgl";var L="canvas";var C="svg";var m={renderer:L};var w={show:true};var R,x=Date.now();var b=FSS.Vector3.create();var Q=FSS.Vector3.create();var z=document.getElementById("output");var I=document.getElementById("ui");var H,y,t,n,U;var k,o,S;var P,T;function s(){g();j();N();r();u();f.resize(G.width(),G.height());V()}function g(){k=new FSS.WebGLRenderer();o=new FSS.CanvasRenderer();S=new FSS.SVGRenderer();O(m.renderer)}function O(i){if(H){z.removeChild(H.element)}switch(i){case X:H=k;break;case L:H=o;break;case C:H=S;break}H.setSize(G.width(),G.height());G.append(H.element);if(h.css("position")=="static"){h.css("position","relative")}}function j(){y=new FSS.Scene();y.vertex=aa;y.line=A}function N(){y.remove(t);H.clear();n=new FSS.Plane(M.width*H.width,M.height*H.height,M.segments,M.slices);U=new FSS.Material(M.ambient,M.diffuse);t=new FSS.Mesh(n,U);y.add(t);var i,ab;for(i=n.vertices.length-1;i>=0;i--){ab=n.vertices[i];ab.anchor=FSS.Vector3.clone(ab.position);ab.step=FSS.Vector3.create(Math.randomInRange(0.2,1),Math.randomInRange(0.2,1),Math.randomInRange(0.2,1));ab.time=Math.randomInRange(0,Math.PIM2)}}function r(){var ab,i;for(ab=y.lights.length-1;ab>=0;ab--){i=y.lights[ab];y.remove(i)}H.clear();for(ab=0;ab<B.length;ab++){for(var ac=0;ac<B[ab].count;ac++){i=new FSS.Light(B[ab].ambient,B[ab].diffuse);i.ambientHex=i.ambient.format();i.diffuseHex=i.diffuse.format();y.add(i);i.mass=Math.randomInRange(0.5,1);i.velocity=FSS.Vector3.create();i.acceleration=FSS.Vector3.create();i.force=FSS.Vector3.create();i.ring=document.createElementNS(FSS.SVGNS,"circle");i.ring.setAttributeNS(null,"stroke",i.ambientHex);i.ring.setAttributeNS(null,"stroke-width","0.5");i.ring.setAttributeNS(null,"fill","none");i.ring.setAttributeNS(null,"r","10");i.core=document.createElementNS(FSS.SVGNS,"circle");i.core.setAttributeNS(null,"fill",i.diffuseHex);i.core.setAttributeNS(null,"r","4")}}}var f={resize:function(ab,i){if(typeof ab=="undefined"||typeof ab===undefined){ab=h.width()}if(typeof i=="undefined"||typeof i===undefined){i=h.height()}H.setSize(ab,i);FSS.Vector3.set(b,H.halfWidth,H.halfHeight);N()},update:function(ae){M=ae.mesh||{};B=ae.lights||[{}];aa=ae.vertex||{};A=ae.line||{};aa=$.extend(true,K,aa);A=$.extend(true,E,A);M=$.extend(true,J,M);var ac=v(h);M=$.extend(true,M,ac[0]);y.vertex=aa;y.line=A;for(var ad=0;ad<B.length;ad++){B[ad]=$.extend(true,Z,B[ad])}for(ad=0,l=y.meshes.length;ad<l;ad++){y.meshes[ad].material.ambient.set(M.ambient);y.meshes[ad].material.diffuse.set(M.diffuse)}if(n.width!==M.width*H.width){N()}if(n.height!==M.height*H.height){N()}if(n.segments!==M.segments){N()}if(n.slices!==M.slices){N()}var ab=0;for(l=0;l<B.length;l++){for(var ad=0;ad<B[l].count;ad++){light=y.lights[ab];light.ambient.set(B[l].ambient);light.ambientHex=light.ambient.format();light=y.lights[ab];light.diffuse.set(B[l].diffuse);light.diffuseHex=light.diffuse.format();ab++}}if(y.lights.length!==ab){r()}},animateValues:function(ad){var ah=ad.length;var ac=Math.round($(document).height()/ah);var af=Math.floor($(window).scrollTop()/ac);var ai=$(window).scrollTop()%ac/ac;var ag=ad[af];var ae=ad[(af+1)%ah];var ab=[];for(var af=0;af<ag.length;af++){ab[af]=ag[af]+((ae[af]-ag[af])*ai);if(af!==3){ab[af]=Math.round(ab[af])}}console.log(ab);return ab},formatRGBA:function(i){var ab="rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+")";return ab}};function V(){R=Date.now()-x;F();D();requestAnimationFrame(V)}function F(){var ae,ad,ac,ag,ai,al,ak,ah=M.depth/2;var af=0;for(ag=0;ag<B.length;ag++){for(var aj=0;aj<B[ag].count;aj++){ai=y.lights[af];FSS.Vector3.copy(B[ag].bounds,b);FSS.Vector3.multiplyScalar(B[ag].bounds,B[ag].xyScalar);FSS.Vector3.setZ(Q,B[ag].zOffset);if(B[ag].autopilot){ae=Math.sin(B[ag].step[0]*R*B[ag].speed);ad=Math.cos(B[ag].step[1]*R*B[ag].speed);FSS.Vector3.set(Q,B[ag].bounds[0]*ae,B[ag].bounds[1]*ad,B[ag].zOffset)}FSS.Vector3.setZ(ai.position,B[ag].zOffset);var ab=Math.clamp(FSS.Vector3.distanceSquared(ai.position,Q),B[ag].minDistance,B[ag].maxDistance);var am=B[ag].gravity*ai.mass/ab;FSS.Vector3.subtractVectors(ai.force,Q,ai.position);FSS.Vector3.normalise(ai.force);FSS.Vector3.multiplyScalar(ai.force,am);FSS.Vector3.set(ai.acceleration);FSS.Vector3.add(ai.acceleration,ai.force);FSS.Vector3.add(ai.velocity,ai.acceleration);FSS.Vector3.multiplyScalar(ai.velocity,B[ag].dampening);FSS.Vector3.limit(ai.velocity,B[ag].minLimit,B[ag].maxLimit);FSS.Vector3.add(ai.position,ai.velocity);af++}}for(al=n.vertices.length-1;al>=0;al--){ak=n.vertices[al];ae=Math.sin(ak.time+ak.step[0]*R*M.speed);ad=Math.cos(ak.time+ak.step[1]*R*M.speed);ac=Math.sin(ak.time+ak.step[2]*R*M.speed);FSS.Vector3.set(ak.position,M.xRange*n.segmentWidth*ae,M.yRange*n.sliceHeight*ad,M.zRange*ah*ac-ah);FSS.Vector3.add(ak.position,ak.anchor)}n.dirty=true}function D(){H.render(y);if(B.draw){var ab,ad,ac,i;for(ab=y.lights.length-1;ab>=0;ab--){i=y.lights[ab];ad=i.position[0];ac=i.position[1];switch(m.renderer){case L:H.context.lineWidth=0.5;H.context.beginPath();H.context.arc(ad,ac,10,0,Math.PIM2);H.context.strokeStyle=i.ambient;H.context.stroke();H.context.beginPath();H.context.arc(ad,ac,4,0,Math.PIM2);H.context.fillStyle=i.diffuse;H.context.fill();break;case C:ad+=H.halfWidth;ac=H.halfHeight-ac;i.core.setAttributeNS(null,"fill",i.diffuse);i.core.setAttributeNS(null,"cx",ad);i.core.setAttributeNS(null,"cy",ac);H.element.appendChild(i.core);i.ring.setAttributeNS(null,"stroke",i.ambient);i.ring.setAttributeNS(null,"cx",ad);i.ring.setAttributeNS(null,"cy",ac);H.element.appendChild(i.ring);break}}}}function u(){$(window).on("resize",d);h.on("click",e);h.on("mousemove",a)}function e(i){FSS.Vector3.set(Q,i.x,H.height-i.y);FSS.Vector3.subtract(Q,b);B.autopilot=!B.autopilot}function a(i){i=i.originalEvent;FSS.Vector3.set(Q,i.x,H.height-i.y);FSS.Vector3.subtract(Q,b)}function d(i){f.resize(h.width(),h.height());D()}s();return f}})();