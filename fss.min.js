FSS={FRONT:0,BACK:1,DOUBLE:2,SVGNS:"http://www.w3.org/2000/svg"};FSS.Array=typeof Float32Array==="function"?Float32Array:Array;FSS.Utils={isNumber:function(a){return !isNaN(parseFloat(a))&&isFinite(a)}};(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,d){var f=new Date().getTime();var e=Math.max(0,16-(f-b));var g=window.setTimeout(function(){h(f+e)},e);b=f+e;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());Math.PIM2=Math.PI*2;Math.PID2=Math.PI/2;Math.randomInRange=function(b,a){return b+(a-b)*Math.random()};Math.clamp=function(c,b,a){c=Math.max(c,b);c=Math.min(c,a);return c};FSS.Vector3={create:function(a,d,c){var b=new FSS.Array(3);this.set(b,a,d,c);return b},clone:function(c){var b=this.create();this.copy(b,c);return b},set:function(b,a,d,c){b[0]=a||0;b[1]=d||0;b[2]=c||0;return this},setX:function(b,a){b[0]=a||0;return this},setY:function(a,b){a[1]=b||0;return this},setZ:function(a,b){a[2]=b||0;return this},copy:function(c,b){c[0]=b[0];c[1]=b[1];c[2]=b[2];return this},add:function(c,b){c[0]+=b[0];c[1]+=b[1];c[2]+=b[2];return this},addVectors:function(e,d,c){e[0]=d[0]+c[0];e[1]=d[1]+c[1];e[2]=d[2]+c[2];return this},addScalar:function(b,a){b[0]+=a;b[1]+=a;b[2]+=a;return this},subtract:function(c,b){c[0]-=b[0];c[1]-=b[1];c[2]-=b[2];return this},subtractVectors:function(e,d,c){e[0]=d[0]-c[0];e[1]=d[1]-c[1];e[2]=d[2]-c[2];return this},subtractScalar:function(b,a){b[0]-=a;b[1]-=a;b[2]-=a;return this},multiply:function(c,b){c[0]*=b[0];c[1]*=b[1];c[2]*=b[2];return this},multiplyVectors:function(e,d,c){e[0]=d[0]*c[0];e[1]=d[1]*c[1];e[2]=d[2]*c[2];return this},multiplyScalar:function(b,a){b[0]*=a;b[1]*=a;b[2]*=a;return this},divide:function(c,b){c[0]/=b[0];c[1]/=b[1];c[2]/=b[2];return this},divideVectors:function(e,d,c){e[0]=d[0]/c[0];e[1]=d[1]/c[1];e[2]=d[2]/c[2];return this},divideScalar:function(b,a){if(a!==0){b[0]/=a;b[1]/=a;b[2]/=a}else{b[0]=0;b[1]=0;b[2]=0}return this},cross:function(d,c){var b=d[0];var f=d[1];var e=d[2];d[0]=f*c[2]-e*c[1];d[1]=e*c[0]-b*c[2];d[2]=b*c[1]-f*c[0];return this},crossVectors:function(e,d,c){e[0]=d[1]*c[2]-d[2]*c[1];e[1]=d[2]*c[0]-d[0]*c[2];e[2]=d[0]*c[1]-d[1]*c[0];return this},min:function(b,a){if(b[0]<a){b[0]=a}if(b[1]<a){b[1]=a}if(b[2]<a){b[2]=a}return this},max:function(b,a){if(b[0]>a){b[0]=a}if(b[1]>a){b[1]=a}if(b[2]>a){b[2]=a}return this},clamp:function(c,b,a){this.min(c,b);this.max(c,a);return this},limit:function(d,b,a){var c=this.length(d);if(b!==null&&c<b){this.setLength(d,b)}else{if(a!==null&&c>a){this.setLength(d,a)}}return this},dot:function(d,c){return d[0]*c[0]+d[1]*c[1]+d[2]*c[2]},normalise:function(a){return this.divideScalar(a,this.length(a))},negate:function(a){return this.multiplyScalar(a,-1)},distanceSquared:function(f,d){var g=f[0]-d[0];var e=f[1]-d[1];var c=f[2]-d[2];return g*g+e*e+c*c},distance:function(d,c){return Math.sqrt(this.distanceSquared(d,c))},lengthSquared:function(b){return b[0]*b[0]+b[1]*b[1]+b[2]*b[2]},length:function(b){return Math.sqrt(this.lengthSquared(b))},setLength:function(c,a){var b=this.length(c);if(b!==0&&a!==b){this.multiplyScalar(c,a/b)}return this}};FSS.Vector4={create:function(a,e,d,c){var b=new FSS.Array(4);this.set(b,a,e,d);return b},set:function(c,a,e,d,b){c[0]=a||0;c[1]=e||0;c[2]=d||0;c[3]=b||0;return this},setX:function(b,a){b[0]=a||0;return this},setY:function(a,b){a[1]=b||0;return this},setZ:function(a,b){a[2]=b||0;return this},setW:function(b,a){b[3]=a||0;return this},add:function(c,b){c[0]+=b[0];c[1]+=b[1];c[2]+=b[2];c[3]+=b[3];return this},multiplyVectors:function(e,d,c){e[0]=d[0]*c[0];e[1]=d[1]*c[1];e[2]=d[2]*c[2];e[3]=d[3]*c[3];return this},multiplyScalar:function(b,a){b[0]*=a;b[1]*=a;b[2]*=a;b[3]*=a;return this},min:function(b,a){if(b[0]<a){b[0]=a}if(b[1]<a){b[1]=a}if(b[2]<a){b[2]=a}if(b[3]<a){b[3]=a}return this},max:function(b,a){if(b[0]>a){b[0]=a}if(b[1]>a){b[1]=a}if(b[2]>a){b[2]=a}if(b[3]>a){b[3]=a}return this},clamp:function(c,b,a){this.min(c,b);this.max(c,a);return this}};FSS.Color=function(b,a){this.rgba=FSS.Vector4.create();this.hex=b||"#000000";this.opacity=FSS.Utils.isNumber(a)?a:1;this.set(this.hex,this.opacity)};FSS.Color.prototype={set:function(c,a){c=c.replace("#","");var b=c.length/3;this.rgba[0]=parseInt(c.substring(b*0,b*1),16)/255;this.rgba[1]=parseInt(c.substring(b*1,b*2),16)/255;this.rgba[2]=parseInt(c.substring(b*2,b*3),16)/255;this.rgba[3]=FSS.Utils.isNumber(a)?a:this.rgba[3];return this},hexify:function(b){var a=Math.ceil(b*255).toString(16);if(a.length===1){a="0"+a}return a},format:function(){var d=this.hexify(this.rgba[0]);var c=this.hexify(this.rgba[1]);var a=this.hexify(this.rgba[2]);this.hex="#"+d+c+a;if(typeof this.rgba[3]!=="undefined"){return"rgba("+this.rgba[0]+","+this.rgba[1]+","+this.rgba[2]+","+this.rgba[3]+")"}return this.hex}};FSS.Object=function(){this.position=FSS.Vector3.create()};FSS.Object.prototype={setPosition:function(a,c,b){FSS.Vector3.set(this.position,a,c,b);return this}};FSS.Light=function(b,a){FSS.Object.call(this);this.ambient=new FSS.Color(b||"#FFFFFF");this.diffuse=new FSS.Color(a||"#FFFFFF");this.ray=FSS.Vector3.create()};FSS.Light.prototype=Object.create(FSS.Object.prototype);FSS.Vertex=function(a,c,b){this.position=FSS.Vector3.create(a,c,b)};FSS.Vertex.prototype={setPosition:function(a,c,b){FSS.Vector3.set(this.position,a,c,b);return this}};FSS.Triangle=function(e,d,f){this.a=e||new FSS.Vertex();this.b=d||new FSS.Vertex();this.c=f||new FSS.Vertex();this.vertices=[this.a,this.b,this.c];this.u=FSS.Vector3.create();this.v=FSS.Vector3.create();this.centroid=FSS.Vector3.create();this.normal=FSS.Vector3.create();this.color=new FSS.Color();this.polygon=document.createElementNS(FSS.SVGNS,"polygon");this.polygon.setAttributeNS(null,"stroke-linejoin","round");this.polygon.setAttributeNS(null,"stroke-miterlimit","1");this.polygon.setAttributeNS(null,"stroke-width","1");this.computeCentroid();this.computeNormal()};FSS.Triangle.prototype={computeCentroid:function(){this.centroid[0]=this.a.position[0]+this.b.position[0]+this.c.position[0];this.centroid[1]=this.a.position[1]+this.b.position[1]+this.c.position[1];this.centroid[2]=this.a.position[2]+this.b.position[2]+this.c.position[2];FSS.Vector3.divideScalar(this.centroid,3);return this},computeNormal:function(){FSS.Vector3.subtractVectors(this.u,this.b.position,this.a.position);FSS.Vector3.subtractVectors(this.v,this.c.position,this.a.position);FSS.Vector3.crossVectors(this.normal,this.u,this.v);FSS.Vector3.normalise(this.normal);return this}};FSS.Geometry=function(){this.vertices=[];this.triangles=[];this.dirty=false};FSS.Geometry.prototype={update:function(){if(this.dirty){var a,b;for(a=this.triangles.length-1;a>=0;a--){b=this.triangles[a];b.computeCentroid();b.computeNormal()}this.dirty=false}return this}};FSS.Plane=function(a,p,e,n){FSS.Geometry.call(this);this.width=a||100;this.height=p||100;this.segments=e||4;this.slices=n||4;this.segmentWidth=this.width/this.segments;this.sliceHeight=this.height/this.slices;var k,i,o,m,j,h,f,d,g=[],c=this.width*-0.5,b=this.height*0.5;for(k=0;k<=this.segments;k++){g.push([]);for(i=0;i<=this.slices;i++){f=new FSS.Vertex(c+k*this.segmentWidth,b-i*this.sliceHeight);g[k].push(f);this.vertices.push(f)}}for(k=0;k<this.segments;k++){for(i=0;i<this.slices;i++){o=g[k+0][i+0];m=g[k+0][i+1];j=g[k+1][i+0];h=g[k+1][i+1];t0=new FSS.Triangle(o,m,j);t1=new FSS.Triangle(j,m,h);this.triangles.push(t0,t1)}}};FSS.Plane.prototype=Object.create(FSS.Geometry.prototype);FSS.Material=function(b,a){this.ambient=new FSS.Color(b||"#444444");this.diffuse=new FSS.Color(a||"#FFFFFF");this.slave=new FSS.Color()};FSS.Mesh=function(b,a){FSS.Object.call(this);this.geometry=b||new FSS.Geometry();this.material=a||new FSS.Material();this.side=FSS.FRONT;this.visible=true};FSS.Mesh.prototype=Object.create(FSS.Object.prototype);FSS.Mesh.prototype.update=function(c,e){var d,f,b,a,g;this.geometry.update();if(e){for(d=this.geometry.triangles.length-1;d>=0;d--){f=this.geometry.triangles[d];FSS.Vector4.set(f.color.rgba);for(b=c.length-1;b>=0;b--){a=c[b];FSS.Vector3.subtractVectors(a.ray,a.position,f.centroid);FSS.Vector3.normalise(a.ray);g=FSS.Vector3.dot(f.normal,a.ray);if(this.side===FSS.FRONT){g=Math.max(g,0)}else{if(this.side===FSS.BACK){g=Math.abs(Math.min(g,0))}else{if(this.side===FSS.DOUBLE){g=Math.max(Math.abs(g),0)}}}FSS.Vector4.multiplyVectors(this.material.slave.rgba,this.material.ambient.rgba,a.ambient.rgba);FSS.Vector4.add(f.color.rgba,this.material.slave.rgba);FSS.Vector4.multiplyVectors(this.material.slave.rgba,this.material.diffuse.rgba,a.diffuse.rgba);FSS.Vector4.multiplyScalar(this.material.slave.rgba,g);FSS.Vector4.add(f.color.rgba,this.material.slave.rgba)}FSS.Vector4.clamp(f.color.rgba,0,1)}}return this};FSS.Scene=function(){this.meshes=[];this.lights=[]};FSS.Scene.prototype={add:function(a){if(a instanceof FSS.Mesh&&!~this.meshes.indexOf(a)){this.meshes.push(a)}else{if(a instanceof FSS.Light&&!~this.lights.indexOf(a)){this.lights.push(a)}}return this},remove:function(a){if(a instanceof FSS.Mesh&&~this.meshes.indexOf(a)){this.meshes.splice(this.meshes.indexOf(a),1)}else{if(a instanceof FSS.Light&&~this.lights.indexOf(a)){this.lights.splice(this.lights.indexOf(a),1)}}return this}};FSS.Renderer=function(){this.width=0;this.height=0;this.halfWidth=0;this.halfHeight=0};FSS.Renderer.prototype={setSize:function(b,a){if(this.width===b&&this.height===a){return}this.width=b;this.height=a;this.halfWidth=this.width*0.5;this.halfHeight=this.height*0.5;return this},clear:function(){return this},render:function(a){return this}};FSS.CanvasRenderer=function(){FSS.Renderer.call(this);this.element=document.createElement("canvas");this.element.style.display="block";this.context=this.element.getContext("2d");this.setSize(this.element.width,this.element.height)};FSS.CanvasRenderer.prototype=Object.create(FSS.Renderer.prototype);FSS.CanvasRenderer.prototype.setSize=function(b,a){FSS.Renderer.prototype.setSize.call(this,b,a);this.element.width=b;this.element.height=a;this.context.setTransform(1,0,0,-1,this.halfWidth,this.halfHeight);return this};FSS.CanvasRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);this.context.clearRect(-this.halfWidth,-this.halfHeight,this.width,this.height);return this};FSS.CanvasRenderer.prototype.render=function(f){FSS.Renderer.prototype.render.call(this,f);var a,g,c,e,b;var d=2*Math.PI;this.clear();this.context.lineJoin="round";this.context.lineWidth=1;for(a=f.meshes.length-1;a>=0;a--){g=f.meshes[a];if(g.visible){g.update(f.lights,true);for(c=g.geometry.triangles.length-1;c>=0;c--){e=g.geometry.triangles[c];b=e.color.format();this.context.beginPath();this.context.moveTo(e.a.position[0],e.a.position[1]);this.context.lineTo(e.b.position[0],e.b.position[1]);this.context.lineTo(e.c.position[0],e.c.position[1]);this.context.closePath();this.context.strokeStyle=f.vertex.lineColor;this.context.fillStyle=b;this.context.stroke();this.context.fill();this.context.beginPath();this.context.arc(e.a.position[0],e.a.position[1],f.vertex.radius,0,d,false);this.context.fillStyle=f.vertex.fill;this.context.fill();this.context.lineWidth=f.vertex.strokeWidth;this.context.strokeStyle=f.vertex.strokeColor;this.context.stroke()}}}return this};FSS.WebGLRenderer=function(){FSS.Renderer.call(this);this.element=document.createElement("canvas");this.element.style.display="block";this.vertices=null;this.lights=null;var a={preserveDrawingBuffer:false,premultipliedAlpha:true,antialias:true,stencil:true,alpha:true};this.gl=this.getContext(this.element,a);this.unsupported=!this.gl;if(this.unsupported){return"WebGL is not supported by your browser."}else{this.gl.clearColor(0,0,0,0);this.gl.enable(this.gl.DEPTH_TEST);this.setSize(this.element.width,this.element.height)}};FSS.WebGLRenderer.prototype=Object.create(FSS.Renderer.prototype);FSS.WebGLRenderer.prototype.getContext=function(b,d){var c=false;try{if(!(c=b.getContext("experimental-webgl",d))){throw"Error creating WebGL context."}}catch(a){console.error(a)}return c};FSS.WebGLRenderer.prototype.setSize=function(b,a){FSS.Renderer.prototype.setSize.call(this,b,a);if(this.unsupported){return}this.element.width=b;this.element.height=a;this.gl.viewport(0,0,b,a);return this};FSS.WebGLRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);if(this.unsupported){return}this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);return this};FSS.WebGLRenderer.prototype.render=function(u){FSS.Renderer.prototype.render.call(this,u);if(this.unsupported){return}var k,a,j,c,p,n,d,i,q,o,x,b,g=false,w=u.lights.length,f,h,s,r,e=0;this.clear();if(this.lights!==w){this.lights=w;if(this.lights>0){this.buildProgram(w)}else{return}}if(!!this.program){for(k=u.meshes.length-1;k>=0;k--){a=u.meshes[k];if(a.geometry.dirty){g=true}a.update(u.lights,false);e+=a.geometry.triangles.length*3}if(g||this.vertices!==e){this.vertices=e;for(i in this.program.attributes){o=this.program.attributes[i];o.data=new FSS.Array(e*o.size);f=0;for(k=u.meshes.length-1;k>=0;k--){a=u.meshes[k];for(j=0,c=a.geometry.triangles.length;j<c;j++){p=a.geometry.triangles[j];for(h=0,s=p.vertices.length;h<s;h++){vertex=p.vertices[h];switch(i){case"side":this.setBufferData(f,o,a.side);break;case"position":this.setBufferData(f,o,vertex.position);break;case"centroid":this.setBufferData(f,o,p.centroid);break;case"normal":this.setBufferData(f,o,p.normal);break;case"ambient":this.setBufferData(f,o,a.material.ambient.rgba);break;case"diffuse":this.setBufferData(f,o,a.material.diffuse.rgba);break}f++}}}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.buffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,o.data,this.gl.DYNAMIC_DRAW);this.gl.enableVertexAttribArray(o.location);this.gl.vertexAttribPointer(o.location,o.size,this.gl.FLOAT,false,0,0)}}this.setBufferData(0,this.program.uniforms.resolution,[this.width,this.height,this.width]);for(n=w-1;n>=0;n--){d=u.lights[n];this.setBufferData(n,this.program.uniforms.lightPosition,d.position);this.setBufferData(n,this.program.uniforms.lightAmbient,d.ambient.rgba);this.setBufferData(n,this.program.uniforms.lightDiffuse,d.diffuse.rgba)}for(q in this.program.uniforms){o=this.program.uniforms[q];b=o.location;x=o.data;switch(o.structure){case"3f":this.gl.uniform3f(b,x[0],x[1],x[2]);break;case"3fv":this.gl.uniform3fv(b,x);break;case"4fv":this.gl.uniform4fv(b,x);break}}}this.gl.drawArrays(this.gl.TRIANGLES,0,this.vertices);return this};FSS.WebGLRenderer.prototype.setBufferData=function(b,a,d){if(FSS.Utils.isNumber(d)){a.data[b*a.size]=d}else{for(var c=d.length-1;c>=0;c--){a.data[b*a.size+c]=d[c]}}};FSS.WebGLRenderer.prototype.buildProgram=function(d){if(this.unsupported){return}var i=FSS.WebGLRenderer.VS(d);var f=FSS.WebGLRenderer.FS(d);var a=i+f;if(!!this.program&&this.program.code===a){return}var e=this.gl.createProgram();var h=this.buildShader(this.gl.VERTEX_SHADER,i);var b=this.buildShader(this.gl.FRAGMENT_SHADER,f);this.gl.attachShader(e,h);this.gl.attachShader(e,b);this.gl.linkProgram(e);if(!this.gl.getProgramParameter(e,this.gl.LINK_STATUS)){var g=this.gl.getError();var c=this.gl.getProgramParameter(e,this.gl.VALIDATE_STATUS);console.error("Could not initialise shader.\nVALIDATE_STATUS: "+c+"\nERROR: "+g);return null}this.gl.deleteShader(b);this.gl.deleteShader(h);e.code=a;e.attributes={side:this.buildBuffer(e,"attribute","aSide",1,"f"),position:this.buildBuffer(e,"attribute","aPosition",3,"v3"),centroid:this.buildBuffer(e,"attribute","aCentroid",3,"v3"),normal:this.buildBuffer(e,"attribute","aNormal",3,"v3"),ambient:this.buildBuffer(e,"attribute","aAmbient",4,"v4"),diffuse:this.buildBuffer(e,"attribute","aDiffuse",4,"v4")};e.uniforms={resolution:this.buildBuffer(e,"uniform","uResolution",3,"3f",1),lightPosition:this.buildBuffer(e,"uniform","uLightPosition",3,"3fv",d),lightAmbient:this.buildBuffer(e,"uniform","uLightAmbient",4,"4fv",d),lightDiffuse:this.buildBuffer(e,"uniform","uLightDiffuse",4,"4fv",d)};this.program=e;this.gl.useProgram(this.program);return e};FSS.WebGLRenderer.prototype.buildShader=function(a,c){if(this.unsupported){return}var b=this.gl.createShader(a);this.gl.shaderSource(b,c);this.gl.compileShader(b);if(!this.gl.getShaderParameter(b,this.gl.COMPILE_STATUS)){console.error(this.gl.getShaderInfoLog(b));return null}return b};FSS.WebGLRenderer.prototype.buildBuffer=function(c,f,d,e,b,g){var a={buffer:this.gl.createBuffer(),size:e,structure:b,data:null};switch(f){case"attribute":a.location=this.gl.getAttribLocation(c,d);break;case"uniform":a.location=this.gl.getUniformLocation(c,d);break}if(!!g){a.data=new FSS.Array(g*e)}return a};FSS.WebGLRenderer.VS=function(a){var b=["precision mediump float;","#define LIGHTS "+a,"attribute float aSide;","attribute vec3 aPosition;","attribute vec3 aCentroid;","attribute vec3 aNormal;","attribute vec4 aAmbient;","attribute vec4 aDiffuse;","uniform vec3 uResolution;","uniform vec3 uLightPosition[LIGHTS];","uniform vec4 uLightAmbient[LIGHTS];","uniform vec4 uLightDiffuse[LIGHTS];","varying vec4 vColor;","void main() {","vColor = vec4(0.0);","vec3 position = aPosition / uResolution * 2.0;","for (int i = 0; i < LIGHTS; i++) {","vec3 lightPosition = uLightPosition[i];","vec4 lightAmbient = uLightAmbient[i];","vec4 lightDiffuse = uLightDiffuse[i];","vec3 ray = normalize(lightPosition - aCentroid);","float illuminance = dot(aNormal, ray);","if (aSide == 0.0) {","illuminance = max(illuminance, 0.0);","} else if (aSide == 1.0) {","illuminance = abs(min(illuminance, 0.0));","} else if (aSide == 2.0) {","illuminance = max(abs(illuminance), 0.0);","}","vColor += aAmbient * lightAmbient;","vColor += aDiffuse * lightDiffuse * illuminance;","}","vColor = clamp(vColor, 0.0, 1.0);","gl_Position = vec4(position, 1.0);","}"].join("\n");return b};FSS.WebGLRenderer.FS=function(a){var b=["precision mediump float;","varying vec4 vColor;","void main() {","gl_FragColor = vColor;","}"].join("\n");return b};FSS.SVGRenderer=function(){FSS.Renderer.call(this);this.element=document.createElementNS(FSS.SVGNS,"svg");this.element.setAttribute("xmlns",FSS.SVGNS);this.element.setAttribute("version","1.1");this.element.style.display="block";this.setSize(300,150)};FSS.SVGRenderer.prototype=Object.create(FSS.Renderer.prototype);FSS.SVGRenderer.prototype.setSize=function(b,a){FSS.Renderer.prototype.setSize.call(this,b,a);this.element.setAttribute("width",b);this.element.setAttribute("height",a);return this};FSS.SVGRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);for(var a=this.element.childNodes.length-1;a>=0;a--){this.element.removeChild(this.element.childNodes[a])}return this};FSS.SVGRenderer.prototype.render=function(f){FSS.Renderer.prototype.render.call(this,f);var a,g,b,e,d,c;for(a=f.meshes.length-1;a>=0;a--){g=f.meshes[a];if(g.visible){g.update(f.lights,true);for(b=g.geometry.triangles.length-1;b>=0;b--){e=g.geometry.triangles[b];if(e.polygon.parentNode!==this.element){this.element.appendChild(e.polygon)}d=this.formatPoint(e.a)+" ";d+=this.formatPoint(e.b)+" ";d+=this.formatPoint(e.c);c=this.formatStyle(e.color.format());e.polygon.setAttributeNS(null,"points",d);e.polygon.setAttributeNS(null,"style",c)}}}return this};FSS.SVGRenderer.prototype.formatPoint=function(a){return(this.halfWidth+a.position[0])+","+(this.halfHeight-a.position[1])};FSS.SVGRenderer.prototype.formatStyle=function(a){var b="fill:"+a+";";b+="stroke:"+a+";";return b};(function(){$.fn.FSS=function(I,y,W){var t=function(i){var Y=[[],[]];var X=[I,y];$.each(X,function(Z){$.each(X[Z],function(ab,ad){if(typeof i.attr("data-fss-"+[ab])!=="undefined"&&typeof i.attr("data-fss-"+[ab])!==false){try{Y[Z][ab]=$.parseJSON(i.attr("data-fss-"+[ab]));return true}catch(ac){}if(typeof Y[Z][ab]!=="object"){Y[Z][ab]=i.attr("data-fss-"+[ab])}}});var aa=(typeof i.attr("data-fss")!=="undefined"&&typeof i.attr("data-fss")!==false?$.parseJSON(i.attr("data-fss")):[]);$.extend(true,Y[Z],aa)});if(ie<9){$.each(Y,function(Z,aa){if(typeof o(Y[Z])!=="undefined"){Y[Z]=o(Y[Z])}if(typeof o(Y[Z])!=="undefined"){Y[Z]=o(Y[Z])}})}return Y};var o=function(i){try{var X=i.split("(")}catch(Y){return}if(typeof X[1]!=="undefined"){X=X[1].split(")")[0].split(",");return"rgb("+X[0]+","+X[1]+","+X[2]+")"}return};var F={width:1.2,height:1.2,depth:10,segments:16,slices:8,xRange:0.8,yRange:0.1,zRange:1,ambient:"rgba(85, 85, 85, 1)",diffuse:"rgba(255, 255, 255, 1)",speed:0.002};var G={radius:0,fill:"rgba(0, 0, 0, 0)",strokeWidth:0,strokeColor:"rgba(0, 0, 0, 0)",};var V={count:2,xyScalar:1,zOffset:100,ambient:"rgba(136, 0, 102, 1)",diffuse:"rgba(255, 136, 0, 1)",speed:0.01,gravity:1200,dampening:0.95,minLimit:10,maxLimit:null,minDistance:20,maxDistance:400,autopilot:false,draw:false,bounds:FSS.Vector3.create(),step:FSS.Vector3.create(Math.randomInRange(0.2,1),Math.randomInRange(0.2,1),Math.randomInRange(0.2,1))};I=$.extend(true,F,I);W=$.extend(true,G,W);for(var S=0;S<y.length;S++){y[S]=$.extend(true,{},V,y[S])}var g=$(this);var C=$("<div class='output' style='position:absolute; overflow:hidden; left:0px;right:0px; top:0; bottom:0;z-index:-1;'></div>");g.append(C);var U=t(g);I=$.extend(true,I,U[0]);var T="webgl";var H="canvas";var z="svg";var k={renderer:H};var u={show:true};var N,v=Date.now();var b=FSS.Vector3.create();var M=FSS.Vector3.create();var x=document.getElementById("output");var E=document.getElementById("ui");var D,w,r,m,Q;var j,n,O;var L,P;function q(){f();h();J();p();s();e.resize(C.width(),C.height());R()}function f(){j=new FSS.WebGLRenderer();n=new FSS.CanvasRenderer();O=new FSS.SVGRenderer();K(k.renderer)}function K(i){if(D){x.removeChild(D.element)}switch(i){case T:D=j;break;case H:D=n;break;case z:D=O;break}D.setSize(C.width(),C.height());C.append(D.element);if(g.css("position")=="static"){g.css("position","relative")}}function h(){w=new FSS.Scene();w.vertex=W}function J(){w.remove(r);D.clear();m=new FSS.Plane(I.width*D.width,I.height*D.height,I.segments,I.slices);Q=new FSS.Material(I.ambient,I.diffuse);r=new FSS.Mesh(m,Q);w.add(r);var i,X;for(i=m.vertices.length-1;i>=0;i--){X=m.vertices[i];X.anchor=FSS.Vector3.clone(X.position);X.step=FSS.Vector3.create(Math.randomInRange(0.2,1),Math.randomInRange(0.2,1),Math.randomInRange(0.2,1));X.time=Math.randomInRange(0,Math.PIM2)}}function p(){var X,i;for(X=w.lights.length-1;X>=0;X--){i=w.lights[X];w.remove(i)}D.clear();for(X=0;X<y.length;X++){for(var Y=0;Y<y[X].count;Y++){i=new FSS.Light(y[X].ambient,y[X].diffuse);i.ambientHex=i.ambient.format();i.diffuseHex=i.diffuse.format();w.add(i);i.mass=Math.randomInRange(0.5,1);i.velocity=FSS.Vector3.create();i.acceleration=FSS.Vector3.create();i.force=FSS.Vector3.create();i.ring=document.createElementNS(FSS.SVGNS,"circle");i.ring.setAttributeNS(null,"stroke",i.ambientHex);i.ring.setAttributeNS(null,"stroke-width","0.5");i.ring.setAttributeNS(null,"fill","none");i.ring.setAttributeNS(null,"r","10");i.core=document.createElementNS(FSS.SVGNS,"circle");i.core.setAttributeNS(null,"fill",i.diffuseHex);i.core.setAttributeNS(null,"r","4")}}}var e={resize:function(X,i){if(typeof X=="undefined"||typeof X===undefined){X=g.width()}if(typeof i=="undefined"||typeof i===undefined){i=g.height()}D.setSize(X,i);FSS.Vector3.set(b,D.halfWidth,D.halfHeight);J()},update:function(ab,Z,ac){ac=$.extend(true,G,ac);ab=$.extend(true,F,ab);var Y=t(g);ab=$.extend(true,ab,Y[0]);w.vertex=ac;for(var aa=0;aa<Z.length;aa++){Z[aa]=$.extend(true,V,Z[aa])}for(aa=0,l=w.meshes.length;aa<l;aa++){w.meshes[aa].material.ambient.set(ab.ambient)}for(aa=0,l=w.meshes.length;aa<l;aa++){w.meshes[aa].material.diffuse.set(ab.diffuse)}if(m.width!==ab.width*D.width){J()}if(m.height!==ab.height*D.height){J()}if(m.segments!==ab.segments){J()}if(m.slices!==ab.slices){J()}var X=0;for(l=0;l<Z.length;l++){for(var aa=0;aa<Z[l].count;aa++){light=w.lights[X];light.ambient.set(Z[l].ambient);light.ambientHex=light.ambient.format();light=w.lights[X];light.diffuse.set(Z[l].diffuse);light.diffuseHex=light.diffuse.format();X++}}if(w.lights.length!==X){p()}},animateColor:function(Y){function aa(aj,ai,i){return"#"+("0"+parseInt(aj,10).toString(16)).slice(-2)+("0"+parseInt(ai,10).toString(16)).slice(-2)+("0"+parseInt(i,10).toString(16)).slice(-2)}var Z=Y.length;var ah=Math.round($(document).height()/Z);var ad=Math.floor($(window).scrollTop()/ah);var af=$(window).scrollTop()%ah/ah;var ac=Y[ad];var ab=Y[(ad+1)%Z];var X=ac[0]+Math.round((ab[0]-ac[0])*af),ae=ac[1]+Math.round((ab[1]-ac[1])*af),ag=ac[2]+Math.round((ab[2]-ac[2])*af);this.update({},[{ambient:aa(X,ae,ag),diffuse:aa(X,ae,ag)}],{})}};function R(){N=Date.now()-v;B();A();requestAnimationFrame(R)}function B(){var aa,Z,Y,ac,ae,ah,ag,ad=I.depth/2;var ab=0;for(ac=0;ac<y.length;ac++){for(var af=0;af<y[ac].count;af++){ae=w.lights[ab];FSS.Vector3.copy(y[ac].bounds,b);FSS.Vector3.multiplyScalar(y[ac].bounds,y[ac].xyScalar);FSS.Vector3.setZ(M,y[ac].zOffset);if(y[ac].autopilot){aa=Math.sin(y[ac].step[0]*N*y[ac].speed);Z=Math.cos(y[ac].step[1]*N*y[ac].speed);FSS.Vector3.set(M,y[ac].bounds[0]*aa,y[ac].bounds[1]*Z,y[ac].zOffset)}FSS.Vector3.setZ(ae.position,y[ac].zOffset);var X=Math.clamp(FSS.Vector3.distanceSquared(ae.position,M),y[ac].minDistance,y[ac].maxDistance);var ai=y[ac].gravity*ae.mass/X;FSS.Vector3.subtractVectors(ae.force,M,ae.position);FSS.Vector3.normalise(ae.force);FSS.Vector3.multiplyScalar(ae.force,ai);FSS.Vector3.set(ae.acceleration);FSS.Vector3.add(ae.acceleration,ae.force);FSS.Vector3.add(ae.velocity,ae.acceleration);FSS.Vector3.multiplyScalar(ae.velocity,y[ac].dampening);FSS.Vector3.limit(ae.velocity,y[ac].minLimit,y[ac].maxLimit);FSS.Vector3.add(ae.position,ae.velocity);ab++}}for(ah=m.vertices.length-1;ah>=0;ah--){ag=m.vertices[ah];aa=Math.sin(ag.time+ag.step[0]*N*I.speed);Z=Math.cos(ag.time+ag.step[1]*N*I.speed);Y=Math.sin(ag.time+ag.step[2]*N*I.speed);FSS.Vector3.set(ag.position,I.xRange*m.segmentWidth*aa,I.yRange*m.sliceHeight*Z,I.zRange*ad*Y-ad);FSS.Vector3.add(ag.position,ag.anchor)}m.dirty=true}function A(){D.render(w);if(y.draw){var X,Z,Y,i;for(X=w.lights.length-1;X>=0;X--){i=w.lights[X];Z=i.position[0];Y=i.position[1];switch(k.renderer){case H:D.context.lineWidth=0.5;D.context.beginPath();D.context.arc(Z,Y,10,0,Math.PIM2);D.context.strokeStyle=i.ambientHex;D.context.stroke();D.context.beginPath();D.context.arc(Z,Y,4,0,Math.PIM2);D.context.fillStyle=i.diffuseHex;D.context.fill();break;case z:Z+=D.halfWidth;Y=D.halfHeight-Y;i.core.setAttributeNS(null,"fill",i.diffuseHex);i.core.setAttributeNS(null,"cx",Z);i.core.setAttributeNS(null,"cy",Y);D.element.appendChild(i.core);i.ring.setAttributeNS(null,"stroke",i.ambientHex);i.ring.setAttributeNS(null,"cx",Z);i.ring.setAttributeNS(null,"cy",Y);D.element.appendChild(i.ring);break}}}}function s(){$(window).on("resize",c);g.on("click",d);g.on("mousemove",a)}function d(i){FSS.Vector3.set(M,i.x,D.height-i.y);FSS.Vector3.subtract(M,b);y.autopilot=!y.autopilot}function a(i){i=i.originalEvent;FSS.Vector3.set(M,i.x,D.height-i.y);FSS.Vector3.subtract(M,b)}function c(i){e.resize(g.width(),g.height());A()}q();return e}})();